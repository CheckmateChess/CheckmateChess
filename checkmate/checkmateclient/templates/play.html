<html>
<title>Game id: {{gameid}}</title>
<body>

{% load staticfiles %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<div name="boardimage" >
    <img  src="{% static "board.gif" %}" width="640px" height="640px" style="position: absolute;left:20px;top:20px;" />
</div>

<div style="position:absolute;left:20px;top:20px;" >
    <table name="boardtable" border="0"  cellpadding="0" cellspacing="0" >
        {% for row in board %}
            <tr>
            {% for cell in row %}
                <td>

                    {% if cell.0 == "r"  %}
                        <img class="cell" name="{{ cell.1 }}"  src="{% static "black_rook.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "n"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "black_knight.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "b"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "black_bishop.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "q"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "black_queen.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "k"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "black_king.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "p"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "black_pawn.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "R"  %}
                        <img class="cell" name="{{ cell.1 }}"  src="{% static "white_rook.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "N"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "white_knight.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "B"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "white_bishop.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "Q"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "white_queen.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "K"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "white_king.png" %}" width="80px" height="80px"/>
                    {% elif cell.0 == "P"  %}
                        <img class="cell" name="{{ cell.1 }}" src="{% static "white_pawn.png" %}" width="80px" height="80px"/>
                    {% else %}
                        <img class="cell" name="{{ cell.1 }}"  src="{% static "blank.gif" %}" width="80px" height="80px"/>
                    {% endif %}

                </td>
            {% endfor %}
            </tr>
        {% endfor %}
    </table>
</div>

<input type="hidden" name="moves">
<input type="hidden" name="color" value="{{color}}">


<div style="position:absolute;left:680px;top:20px;" >
    <table id="historytable" border="2"  cellpadding="0" cellspacing="0" >
            <tr style="display:block;" >
                <th>White</th>
                <th>Black</th>
            </tr>
        <tbody style="height:400px;overflow:auto;display:block;" >
            {% for row in history %}
                <tr>
                    <td  >
                        {{ row.0 }}
                    </td>
                    <td  >
                        {{ row.1 }}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
    </table>
</div>

<div style="display:block;position:absolute;left:800px;top:20px;" >
    <label>Depth:</label>
    <input id="depth" type="number" value="{{depth}}">
</div>

<div style="position:absolute;left:1100px;top:20px;" >
    <input id="newgame" type="button" value="New Game">
</div>

<div style="position:absolute;left:800px;top:100px;" >
    <label>Book:</label>
    <input id="book" type="file">
</div>

<div style="position:absolute;left:800px;top:200px;" >
    <input type="checkbox" value="enabled">Enable Book
</div>

<div style="position:absolute;left:800px;top:300px;" >
    <label>Book Mode:</label>
    <select>
        <option value="best">Best</option>
        <option value="random" selected="selected">Random</option>
        <option value="worst">Worst</option>

    </select>
</div>

<div style="position:absolute;left:1100px;top:100px;" >
    <input type="button" value="Hint">
</div>

<div style="position:absolute;left:1100px;top:200px;" >
     <label>Save:</label>
    <input type="text">
</div>

<div style="position:absolute;left:1100px;top:300px;" >
     <label>Load:</label>
    <input type="text">
</div>

<div style="position:absolute;left:800px;top:400px;" >
    <input type="button" value="Exit">
</div>

<div style="position:absolute;left:1100px;top:400px;" >
    <input type="button" value="Give Up!">
</div>

<div align="middle">
    <img id="pure_white" style="position:absolute;left:0px;top:0px;opacity:0.5;" src="{% static "pure_white.png" %}" hidden="true">
    <img id="loader" style="position:absolute;left:200px;top:200px;opacity:0.5;" src="{% static "loader.gif" %}" hidden="true" >
</div>

<script>

$(".cell").click( function() { document.getElementsByName('moves')[0].value += this.name; control();  });


$("#book").change( function( ) {




 } )


function make_get( data , func )
{
    $("#pure_white").show();
    $("#loader").show();
    $.get('/handlepost/','query='+data+'&color={{color}}&gameid={{gameid}}',function(data){ func(data);$("#pure_white").hide(); $("#loader").hide();  },'json');
}


$("#depth").change( function() {
  make_get('{"op":"play","params":["setdepth","'+ this.value +'"]}' , function(data){

  });


  });

$("#newgame").click( function() {

    make_get('{"op":"play","params":["newgame"]}' ,function(data){

            update_board_and_history(data);

    } );
    $('[name="moves"]').val('');
    $("#depth")[0].value = 3;

});



function update_board_and_history(data){
    for(var i=0;i<8;i++)
    {
        for(var j=0;j<8;j++)
        {
            var loc = String.fromCharCode('a'.charCodeAt(0)+j) + (8-i);
            var cell = $('[name="'+loc+'"]');

            if(data.board[i][j]=="r")
                cell.attr("src","/static/black_rook.png" );
            else if(data.board[i][j]=="n")
                cell.attr("src","/static/black_knight.png" );
            else if(data.board[i][j]=="b")
                cell.attr("src","/static/black_bishop.png" );
            else if(data.board[i][j]=="q")
                cell.attr("src","/static/black_queen.png" );
            else if(data.board[i][j]=="k")
                cell.attr("src","/static/black_king.png" );
            else if(data.board[i][j]=="p")
                cell.attr("src","/static/black_pawn.png" );
            else if(data.board[i][j]=="R")
                cell.attr("src","/static/white_rook.png" );
            else if(data.board[i][j]=="N")
                cell.attr("src","/static/white_knight.png" );
            else if(data.board[i][j]=="B")
                cell.attr("src","/static/white_bishop.png" );
            else if(data.board[i][j]=="Q")
                cell.attr("src","/static/white_queen.png" );
            else if(data.board[i][j]=="K")
                cell.attr("src","/static/white_king.png" );
            else if(data.board[i][j]=="P")
                cell.attr("src","/static/white_pawn.png" );
            else
                cell.attr("src","/static/blank.gif" );
        }
    }

    historytable = $("#historytable tbody")[1];
    historytable.innerHTML = "";

    for(var i=0;i<data.history.White.length;i++)
    {
        var current = historytable.insertRow();
        current.innerHTML = "<td>" + data.history.White[i] + "</td><td>" + data.history.Black[i] + "</td>";
    }

}

function control()
{

    if( $('[name="moves"]').val().length == 4 )
    {
        make_get('{"op":"play","params":["nextmove","{{color}}","'+$('[name="moves"]').val()+'"]}' ,function(data){

            update_board_and_history(data);

        } );


        $('[name="moves"]').val('');



    }
}



</script>

</body>
</html>
